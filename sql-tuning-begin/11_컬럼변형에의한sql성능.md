# 11. 컬럼 변형에 의한 sql 성능 이해하기

## Ⓜ️ 조회 컬럼과 변수의 데이터 타입을 맞추자

만약 Optimizer가 Full Table Scan을 수행한다면, 요소들을 확인해봐야된다.

- 통계정보가 잘못된 경우
- 인덱스가 존재하지 않은 경우
- 컬럼변형에 의한 경우

### 1. 통계정보가 잘못된 경우

테이블이 생성된지 얼마 안된 경우에는 통계정보 수집이 안되었을 수 있다.
이런경우에는 Full Table Scan이 일어날 가능성이 있다.

### 2. 인덱스가 존재하지 않는다.
이건 확인해보면 되므로 생략

### 3. 컬럼 변형에 의한 경우

아마 대부분의 경우가 이 경우이거나, 개인적으로는 인덱스가 여러개 조합되어 걸려있는 경우 순서가 맞지 않다거나 이런 이유도 있는 것 같다.

이 부분 역시 컬럼을 맞춰주면된다. 옵티마이저는 컬럼과 변수의 데이터타입이 다를 경우에는 컬럼 데이터 타입을 기준으로 변수의 데이터 타입을 형변환해준다.

변수와 컬럼의 데이터타입을 맞추자.

또한 조인시에도 조인키 간의 데이터 타입을 맞추는 것도 중요하다.

## 🅱️ 컬럼에 불필요한 Oracle 제공함수를 사용하지 말아라

흔히 말하는 좌변을 연산하지 말라는 것과 일치한다고 생각한다,

사실 좌변의 컬럼에 연산을 하는 것이 문제가 아니라 컬럼 자체에 함수를 걸어 변형을 일으키지 말라는 것이다.

이는 대부분이 인지하는 부분이고 사실 어쩔수 없는 경우에는 그냥 사용하기도 한다.

하지만 애플리케이션의 소스 단에서 sql의 변수로 할당해줄때 함수안쓰고 할당이 가능하면 
그렇게 바꾸는게 훨씬 성능적으로 이득이다.

### 파티션 키의 변형

파티션 키는 대부분 월별로 분할하여 관리해야 하는 경우 사용하는 것 같다.

파티션이 되어있는 테이블을 만약 풀스캔하여 파티션이 의미없게 되어 버린다면, 그만큼 손해인것도 없을 것이다.

대부분 날짜로 파티션키가 걸려있을 것이기 때문에, 데이터 타입을 잘 맞춰주자.

