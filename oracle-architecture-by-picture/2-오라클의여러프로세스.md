# 2. 오라클의 여러 프로세스

# 😁 1. 데이터베이스의 데이터는 모두의 것

![image](https://github.com/user-attachments/assets/8a6d026f-3002-4fce-8edf-f81e56a6f75b)


오라클에게 각종 프로그램은 고객입니다. SQL Plus나 JDBC 등 여러 프로그램들은 오라클한테 요청을 합니다.

오라클은 여러개의 프로세스로 각각 응답을 해줍니다.
**여러개**라는 점이 중요합니다.

데이터베이스를 사용하지 않는 프로그램들에서 즉 일반적인 프로그래밍 언어에서는 프로세스들이 서로의 변수를 침범할 일이 없습니다. 가지고 있는 변수 A에 대해서 서로 침범할 일이 없죠.

하지만 데이터베이스는 여러개의 요청을 처리하는 즉 여러명의 사용자가 하나의 데이터베이스를 사용하기에 이러한 부분의 관리가 되어야합니다. 

**데이터가 공유되는 것**

여기서 Lock 개념이 도입되는 것입니다.

하지만 Lock은 추후의 8장에서 다루겠습니다.

# 🥸 2. 오라클이 여러 개의 프로세스로 구성된 이유

### **다중 처리를 위해서**

어떤 SQL문은 처리되는데 1시간 이상이 걸리기도 합니다. 긴 시간이 걸리는 동안에 아무런 작업도 하지 않으면 낭비죠.

또한 디스크 접근은 메모리 보다 훨씬 느리기에, CPU를 방치하지 않고 다른 SQL 처리도 하게 하는 것이죠.

## 서버 프로세스와 백그라운드 프로세스

그래서 오라클은 하나의 SQL PLUS 즉 오라클 클라이언트 하나에 서버 프로세스 하나에 대응해서 작동합니다(Shared Server 제외).


일반적인 병렬처리 역시 여러개의 프로세스로 실행하는 것과 동일합니다.

서버 프로세스는 SQL문을 처리하고, 백그라운드 프로세스는 서버 프로세스를 지원합니다.

![image](https://github.com/user-attachments/assets/4d3f0900-c0c1-4b15-aaef-b8de126f0d46)



그림으로 보면 이해가 쉽습니다. 서버 프로세스는 클라이언트와 통신합니다.

# 🪟 3. 각 프로세스가 수행하는 처리

1. SQL문 수신
2. SQL문 파싱
3. 데이터 읽기(디스크에서 읽어온다.)
4. 데이터 기록(디스크에 쓰는 거)
5. SQL문 결과 회신
6. 로그 기록
7. 각종 정리
8. 로그 보관(아카이브)

<img width="587" alt="image" src="https://github.com/user-attachments/assets/2d2e34b8-3500-490d-a25b-3458a5d77eb1" />


여기서 서버 프로세스는 고객을 최우선으로 생각하는 영업 담당자다. 즉 고객은 SQL문을 날리고 서버 프로세스는 1,2,3,5를 수행해서 빠르게 결과를 회신해주는 것입니다.

데이터를 기록하는 4번 과정은 고객 입장에서 결과를 회신하는 것과 관련이 없기에 5번을 바로 수행해주는 것입니다.

이런 4번과 같은 과정은 백그라운드 (포어그라운드) 프로세스가 수행하게 됩니다.**DBWR**

> 또 다른 이유로는 디스크에 기록하는 것은 시간이 오래걸리기에 클라이언트가 그만큼 기다려야되서 4번 작업인 디스크 기록을 수행하지 않는 것입니다.

<img width="576" alt="image" src="https://github.com/user-attachments/assets/70b1544f-8b88-4ab1-a6b9-ec3b06908d38" />


## 오라클 RAC

Real Application Clusters의 약자로서 여러개의 서버상 가동된 인스턴스들이 하나의 데이터베이스를 공유해서 사용하는 것.

즉 서버 부하가 나눠지겠죠? 서버는 여러개지만 데이터의 일관성을 위해서 스토리지는 함께사용하는 거죠.

HA와 비교해서 HA는 active/standby 상태로 하나만 활용되지만, 오라클 RAC는 active/active 구조로 서버의 CPU나 메모리 자원 100% 사용이 가능한 좋은 구조죠.

장애가 발생해도 나머지 인스턴스에서 작업이 가능하기에 장애 대응도 잘되고, 서버 추가 삭제가 가능하기에 가용성 부분에서도 좋은 것입니다.

## 개인적 궁금증
### WAS와 DB인스턴스, DB 커넥션 풀 관계

그냥 문뜩 궁금해졌습니다.

그래서 찾아본 결과

```less
──────────────────────────────────
|       WAS 인스턴스 1       |       WAS 인스턴스 2       |
──────────────────────────────────
        │                                │
──────────────────────────────────
|  DB 인스턴스 1  |  DB 인스턴스 2  |  DB 인스턴스 3  |
──────────────────────────────────
        │                      │                      │
      [ 공유 데이터베이스 (Shared Database) ]

```

이런식으로 된다고 합니다.

✅ 각 WAS 인스턴스는 RAC 환경의 여러 DB 인스턴스와 연결될 수 있음.

✅ WAS에서는 커넥션 풀을 이용해 DB 연결을 관리하고, 이 커넥션이 RAC의 여러 노드(DB 인스턴스)로 분산될 수 있음.

✅ 이렇게 하면 트랜잭션 부하가 여러 DB 인스턴스로 자동 분배되므로 성능이 향상됨.

# 요약

- 데이터 베이스는 모두 공유해서 사용
- 오라클 클라이언트(자바,sql plus)가 여러개 존재하고, 여러개의 sql문이 오라클에 전달된다.
- 오라클 위에서 여러개의 sql문이 동시에ㅔ 동작한다.
- 서버프로세스는 SQL문의 결과를 빠르게 회신하도록 일한다.
- 서버프로세스를 도와주는 백그라운드 프로세스가 존재한다.

### 그래서 왜 프로세스에 대해 알아야될까?

#### 질문 
#### 튜닝할 때 어떤 프로세스를 봐야될까요?
-> 작업을 처리하는 서버 프로세스를 봐야겠죠? 백그라운드 프로세스는 서버 프로세스를 방해하지않는 한 볼일이 없어요.

#### OS확인해보니 서버 프로세스가 디스크에서 데이터를 대량으로 읽어오는 것이 판명되었다. 이게 문제인가?

-> 아니다. 왜냐하면 서버프로세는 원래 읽어오는게 맞기에 근데 SQL문을 봐서 대량으로 읽는게 타당한지 조사해야된다.


**이러한 답변을 할 수 있게 됩니다**
